# InsightFlow RSS - Документация проекта (обновлено 05.07.2025)

## Общая архитектура

Проект InsightFlow RSS представляет собой систему для:

1. Сбора данных из RSS-лент и по SOAP API Медиалогии
2. Классификации контента
3. Анализа и агрегации информации
4. Отправки результатов в Telegram

Основные компоненты системы:

```
┌────────────────┐   ┌────────────────┐   ┌─────────────────────┐
│RSS + Медиалогия│──▶│  DataManager   │──▶│  ContentClassifier  │
└────────────────┘   └────────────────┘   └─────────────────────┘
        │                     │                      │
        ▼                     ▼                      ▼
┌────────────────┐   ┌────────────────┐   ┌─────────────────────┐
│ BatchManager   │   │ RelevanceChecker│   │    TokenEstimator   │
└────────────────┘   └────────────────┘   └─────────────────────┘
        │                     │                      │
        ▼                     ▼                      ▼
┌────────────────┐   ┌────────────────┐   ┌─────────────────────┐
│ LMStudioClient │◀─▶│ InsightFlow    │◀──│      DBManager      │
└────────────────┘   └────────────────┘   └─────────────────────┘
        ▲                     │                      ▲
        │                     ▼                      │
┌────────────────┐   ┌────────────────┐   ┌─────────────────────┐
│  TelegramSender│◀───│  Scheduler    │───▶│  TextPreprocessor   │
└────────────────┘   └────────────────┘   └─────────────────────┘
```

## Файлы проекта

### Основные модули

* batch\_manager.py — управление батчами постов
* content\_classifier.py — классификация контента
* data\_manager.py — объединение и управление данными из всех источников
* db\_manager.py — работа с базой данных
* insightflow\_service.py — основной сервис
* lm\_studio\_client.py — клиент для LM Studio
* mlg\_manager.py — получение публикаций из Медиалогии по SOAP
* rss\_manager.py — получение публикаций из RSS
* scheduler.py — планировщик задач
* telegram\_sender.py — отправка в Telegram
* text\_preprocessing.py — предобработка текста
* token\_estimator.py — оценка количества токенов

### Вспомогательные файлы

* docker-compose.yml — конфигурация Docker
* Dockerfile — конфигурация контейнера
* requirements.txt — зависимости Python
* rss\_sources.json — источники RSS
* README.md — основная информация о проекте
* documentation.md — данная документация

### SQL скрипты

* sql/init.sql — инициализация БД
* sql/migration\_add\_html\_content.sql — миграция
* sql/add\_relevance\_fields.sql — добавление полей

## Основные изменения (интеграция Медиалогии)

1. Добавлен модуль `mlg_manager.py`:

   * SOAP-клиент для получения публикаций по `report_id`
   * Пагинация и фильтрация по дате

2. Обновлён `DataManager`:

   * Объединяет данные из RSS и Медиалогии
   * Унифицированный интерфейс `fetch_posts()`

3. Обновлён `insightflow_service.py`:

   * Использует `fetch_posts()` для анализа

4. Поддержка сохранения всех источников в `db_manager.py`:

   * `blog_host_type` учитывается при вставке

5. Планировщик `scheduler.py` работает без изменений — получает данные из обоих источников автоматически

## Актуальная последовательность работы

1. **Получение данных (RSS + Медиалогия)**

   * RSS: чтение конфигурации, асинхронный парсинг лент
   * Медиалогия: SOAP-запросы к API с пагинацией
   * Все посты объединяются в `DataManager`

2. **Обработка (DataManager → DBManager)**

   * Сохранение новых публикаций
   * Проверка релевантности (RelevanceChecker)
   * Классификация (ContentClassifier)

3. **Анализ (InsightFlow)**

   * Группировка постов (BatchManager)
   * Анализ через LM Studio
   * Формирование Telegram-дайджеста

4. **Отправка (TelegramSender)**

   * Форматирование и доставка итогов

---

Документация обновлена: **05.07.2025**, автор: ADEMSU
